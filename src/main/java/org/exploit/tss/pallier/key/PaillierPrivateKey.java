package org.exploit.tss.pallier.key;

import org.exploit.gmp.BigInt;

import javax.security.auth.Destroyable;

public class PaillierPrivateKey implements Destroyable {
    private final BigInt lambda;
    private final BigInt mu;
    private final BigInt p;
    private final BigInt q;

    private final BigInt p2;
    private final BigInt q2;
    private final BigInt lambdaP;
    private final BigInt lambdaQ;
    private final BigInt invQ2modP2;
    private final BigInt invP2modQ2;

    public PaillierPrivateKey(BigInt lambda, BigInt mu, BigInt p, BigInt q) {
        this.lambda = lambda;
        this.mu  = mu;
        this.p = p;
        this.q = q;

        this.p2 = p.multiply(p);
        this.q2 = q.multiply(q);

        BigInt phiP2 = p.multiply(p.subtract(BigInt.ONE));
        BigInt phiQ2 = q.multiply(q.subtract(BigInt.ONE));

        this.lambdaP = lambda.mod(phiP2);
        this.lambdaQ = lambda.mod(phiQ2);

        this.invQ2modP2 = q2.modInverse(p2);
        this.invP2modQ2 = p2.modInverse(q2);
    }

    public BigInt lambda() {
        return lambda;
    }

    public BigInt mu()     {
        return mu;
    }

    public BigInt p() {
        return p;
    }

    public BigInt q() {
        return q;
    }

    public BigInt p2() {
        return p2;
    }

    public BigInt q2() {
        return q2;
    }

    public BigInt lambdaP() {
        return lambdaP;
    }
    public BigInt lambdaQ() {
        return lambdaQ;
    }

    public BigInt invQ2modP2() {
        return invQ2modP2;
    }

    public BigInt invP2modQ2() {
        return invP2modQ2;
    }

    public PaillierPublicKey publicKey() {
        var n = p.multiplySec(q);
        return new PaillierPublicKey(n, n.add(BigInt.ONE), n.bitLength());
    }

    @Override
    public void destroy() {
        lambda.destroy();
        mu.destroy();
        p.destroy();
        q.destroy();
        p2.destroy();
        q2.destroy();
        lambdaP.destroy();
        lambdaQ.destroy();
        invQ2modP2.destroy();
        invP2modQ2.destroy();
    }
}