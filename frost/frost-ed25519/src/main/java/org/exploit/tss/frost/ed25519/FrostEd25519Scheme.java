package org.exploit.tss.frost.ed25519;

import org.exploit.ed25519.Ed25519PointOps;
import org.exploit.gmp.BigInt;
import org.exploit.tss.frost.ciphersuite.FrostCipherSuite;
import org.exploit.tss.frost.ed25519.ciphersuite.FrostEd25519Sha512V1CipherSuite;
import org.exploit.tss.frost.model.ContextOfR;
import org.exploit.tss.frost.schema.DefaultFrostScheme;
import org.exploit.tss.signature.SchnorrSignature;
import org.exploit.tss.signature.Signature;
import org.exploit.tss.util.Endian;

public class FrostEd25519Scheme extends DefaultFrostScheme<Ed25519PointOps> {
    @Override
    public Signature buildSignature(ContextOfR<Ed25519PointOps> context, BigInt s, BigInt q) {
        var r32 = context.canon().encode(true);
        var sLe32 = Endian.toLittleEndian(s.mod(q), 32);

        return new SchnorrSignature(r32, sLe32);
    }

    @Override
    protected FrostCipherSuite<Ed25519PointOps> cipherSuite() {
        return new FrostEd25519Sha512V1CipherSuite();
    }
}