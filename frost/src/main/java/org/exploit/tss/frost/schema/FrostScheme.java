package org.exploit.tss.frost.schema;

import org.exploit.gmp.BigInt;
import org.exploit.tss.curve.PointOps;
import org.exploit.tss.frost.model.ContextOfR;
import org.exploit.tss.frost.model.ParticipantCommitment;
import org.exploit.tss.signature.SchnorrSignature;

import java.util.List;

public interface FrostScheme<P extends PointOps<P>> {
    byte[] prepareMessage(byte[] msg);

    BigInt h1(int idx, byte[] msgPrepared, byte[] additionalContext, List<ParticipantCommitment<P>> B, BigInt q);

    ContextOfR<P> computeRCtx(P raw);

    BigInt h2(ContextOfR<P> rCtx, P Y, byte[] msgPrepared, byte[] additionalContext, BigInt q);

    default BigInt applyShareTerm(BigInt share, BigInt c, P Y, BigInt q) {
        return share.multiplySec(c).mod(q);
    }

    default BigInt keyCoefficient(BigInt lambda, BigInt c, P Y, BigInt q) {
        return lambda.multiply(c).mod(q);
    }

    default BigInt finalizeS(BigInt zSum, BigInt c, P Y, BigInt q) {
        return zSum.mod(q);
    }

    SchnorrSignature buildSignature(ContextOfR<P> rCtx, BigInt sFinal, BigInt q);
}