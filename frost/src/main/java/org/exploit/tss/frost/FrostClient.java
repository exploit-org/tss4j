package org.exploit.tss.frost;

import org.exploit.tss.constant.ThresholdSignatureType;
import org.exploit.tss.curve.PointOps;
import org.exploit.tss.curve.ThresholdSessionClient;
import org.exploit.tss.frost.aggregator.SignaturePartAggregator;
import org.exploit.tss.frost.context.FrostContext;
import org.exploit.tss.frost.preprocessor.FrostPreProcessor;
import org.exploit.tss.frost.schema.FrostScheme;
import org.exploit.tss.frost.signature.FrostPartialSignatureClient;

public class FrostClient<P extends PointOps<P>> implements ThresholdSessionClient {
    private final String sessionId;
    private final FrostContext<P> context;
    private final FrostPreProcessor<P> preProcessor;
    private final FrostPartialSignatureClient<P> signature;
    private final SignaturePartAggregator<P> aggregator;
    private final FrostScheme<P> scheme;

    public FrostClient(String sessionId, FrostContext<P> context, FrostScheme<P> scheme) {
        this.context = context;
        this.sessionId = sessionId;
        this.preProcessor = new FrostPreProcessor<>(context);
        this.signature = new FrostPartialSignatureClient<>(context, scheme);
        this.aggregator = new SignaturePartAggregator<>(scheme, context, signature);
        this.scheme = scheme;
    }

    @Override
    public ThresholdSignatureType type() {
        return ThresholdSignatureType.SCHNORR;
    }

    public String sessionId() {
        return sessionId;
    }

    public FrostScheme<P> scheme() {
        return scheme;
    }

    public FrostPartialSignatureClient<P> signature() {
        return signature;
    }

    public FrostPreProcessor<P> preProcessor() {
        return preProcessor;
    }

    public SignaturePartAggregator<P> aggregator() {
        return aggregator;
    }

    public FrostContext<P> context() {
        return context;
    }

    @Override
    public void destroy() {
        context.destroy();
    }
}
