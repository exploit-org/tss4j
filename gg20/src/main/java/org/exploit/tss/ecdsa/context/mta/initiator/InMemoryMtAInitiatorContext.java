package org.exploit.tss.ecdsa.context.mta.initiator;

import org.exploit.gmp.BigInt;
import org.exploit.tss.mta.model.MtAInitiatorMessage;
import org.exploit.tss.util.Sum;

import java.util.Map;
import java.util.Objects;
import java.util.concurrent.ConcurrentHashMap;

public class InMemoryMtAInitiatorContext implements MtAInitiatorContext {
    private MtAInitiatorMessage message;

    private final Map<Integer, BigInt> alphas = new ConcurrentHashMap<>();
    private final Map<Integer, BigInt> mus = new ConcurrentHashMap<>();

    @Override
    public void setInitiatorMessage(MtAInitiatorMessage message) {
        this.message = message;
    }

    @Override
    public void storeAlpha(int peerId, BigInt alpha) {
        alphas.put(peerId, Objects.requireNonNull(alpha));
    }

    @Override
    public void storeMu(int peerId, BigInt mu) {
        mus.put(peerId, Objects.requireNonNull(mu));
    }

    @Override
    public BigInt modSumAlpha(BigInt delta, BigInt q) {
        return Sum.modSum(delta, q, alphas.values());
    }

    @Override
    public BigInt modSumMu(BigInt sigma, BigInt q) {
        return Sum.modSum(sigma, q, mus.values());
    }

    @Override
    public MtAInitiatorMessage message() {
        return Objects.requireNonNull(message, "Initiator message not set (init not called?)");
    }

    @Override
    public boolean isInitialized() {
        return message != null;
    }
}
