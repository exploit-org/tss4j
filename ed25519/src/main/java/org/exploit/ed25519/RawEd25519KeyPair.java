package org.exploit.ed25519;

import lombok.AllArgsConstructor;
import lombok.Data;
import org.exploit.sodium.Sodium;
import org.exploit.tss.key.KeyPair;

import java.util.Arrays;

@Data
@AllArgsConstructor
public class RawEd25519KeyPair implements KeyPair<byte[], byte[]> {
    private final byte[] publicKey;
    private final byte[] secretKey;

    public byte[] getFullSecretKey() {
        var pk = new byte[Sodium.crypto_sign_ed25519_PUBLICKEYBYTES];
        var sk = new byte[Sodium.crypto_sign_ed25519_SECRETKEYBYTES];

        if (Sodium.INSTANCE.crypto_sign_ed25519_seed_keypair(pk, sk, secretKey) != 0) {
            throw new IllegalStateException("Seed RawKeyPair generation failed");
        }
        if (!Arrays.equals(pk, publicKey)) {
            throw new IllegalStateException("Public key mismatch");
        }

        return sk;
    }
}
